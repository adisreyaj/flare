<article
  *ngIf="user$ | async as loggedInUser"
  class="relative border-b border-slate-200 bg-white p-4"
>
  <ng-container
    *ngIf="loggedInUser.id === flare.author.id && context !== 'FLARE_DETAIL'"
  >
    <div class="absolute top-2 right-2 z-10">
      <button [zzDropdownTrigger]="flareMoreOptions" variant="link" zzButton>
        <rmx-icon class="icon-xs" name="more-fill"></rmx-icon>
        <zz-dropdown #flareMoreOptions>
          <div
            (click)="
              context === 'FEED' ? deleteFlare(flare) : removeBookmark(flare)
            "
            class="text-red-600"
            zzDropdownCloseOnClick
            zzDropdownItem
          >
            {{ context === 'FEED' ? 'Delete' : 'Remove Bookmark' }}
          </div>
        </zz-dropdown>
      </button>
    </div>
  </ng-container>
  <header class="relative flex items-center justify-start">
    <div
      [routerLink]="['/', flare.author.username]"
      class="group flex cursor-pointer items-center gap-2"
    >
      <img
        [alt]="flare.author.firstName"
        [flareDefaultImage]="flare.author.username"
        [src]="flare.author.image"
        class="h-10 w-10 rounded-full"
      />
      <div class="gap-2 group-hover:text-primary">
        <p class="text-sm font-medium">
          {{ flare.author.firstName }} {{ flare.author.lastName }}
        </p>
        <p class="cursor-pointer text-xs font-medium">
          @{{ flare.author.username }}
        </p>
      </div>
    </div>
  </header>
  <div
    (click)="routeToFlareDetail(flare.id)"
    [class.cursor-pointer]="context !== 'FLARE_DETAIL'"
    class="py-4"
  >
    <ul class="flex flex-col gap-2">
      <ng-container *ngFor="let block of flare.blocks">
        <ng-container [ngSwitch]="block?.type">
          <ng-container *ngSwitchCase="blockTypes.text">
            <flare-block-text-renderer
              [content]="block?.content"
            ></flare-block-text-renderer>
          </ng-container>
          <ng-container *ngSwitchCase="blockTypes.script">
            <flare-block-script-renderer
              [content]="block?.content"
            ></flare-block-script-renderer>
          </ng-container>
          <ng-container *ngSwitchCase="blockTypes.code">
            <flare-block-code-renderer
              [content]="block.content"
            ></flare-block-code-renderer>
          </ng-container>
          <ng-container *ngSwitchCase="blockTypes.images">
            <flare-block-image-renderer
              [content]="block?.content"
            ></flare-block-image-renderer>
          </ng-container>
        </ng-container>
      </ng-container>
    </ul>
  </div>
  <footer class="flex gap-4">
    <button (click)="toggleLike(flare)" size="sm" variant="link" zzButton>
      <div class="flex items-center gap-2">
        <rmx-icon [name]="flare | flareLikeIcon" class="icon-xxs"></rmx-icon>
        <p>{{ flare._count?.likes }}</p>
      </div>
    </button>
    <button class="flex items-center gap-2" size="sm" variant="link" zzButton>
      <div class="flex items-center gap-1">
        <rmx-icon class="icon-xxs" name="chat-1-line"></rmx-icon>
        <p>{{ flare._count?.comments }}</p>
      </div>
    </button>
    <ng-container *ngIf="context === 'FEED'">
      <button (click)="toggleBookmark(flare)" variant="link" zzButton>
        <rmx-icon
          [name]="flare | flareBookmarkIcon"
          class="icon-xxs"
        ></rmx-icon>
      </button>
    </ng-container>
    <button [zzDropdownTrigger]="shareOptions" variant="link" zzButton>
      <rmx-icon class="icon-xxs" name="share-line"></rmx-icon>
      <zz-dropdown #shareOptions>
        <div
          [cdkCopyToClipboard]="'https://flare.adi.so/flare/' + flare.id"
          class="w-full text-red-500"
          zzDropdownCloseOnClick
          zzDropdownItem
        >
          Copy Flare Link
        </div>
      </zz-dropdown>
    </button>
  </footer>
</article>
